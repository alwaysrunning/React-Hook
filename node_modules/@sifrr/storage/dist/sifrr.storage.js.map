{"version":3,"file":"sifrr.storage.js","sources":["../src/utils/json.ts","../src/utils/dataparser.ts","../src/storages/storage.ts","../src/storages/indexeddb.ts","../src/storages/websql.ts","../src/storages/localstorage.ts","../src/storages/cookies.ts","../src/storages/jsonstorage.ts","../src/sifrr.storage.ts"],"sourcesContent":["const toS = Object.prototype.toString;\nconst uId = '~SS%l3g5k3~';\n\nfunction decodeBlob(str, type) {\n  return new Blob([new Uint8Array(str.split(',')).buffer], { type });\n}\n\nfunction encodeBlob(blob) {\n  const uri = URL.createObjectURL(blob),\n    xhr = new XMLHttpRequest();\n\n  xhr.open('GET', uri, false);\n  xhr.send();\n\n  URL.revokeObjectURL(uri);\n\n  const ui8 = new Uint8Array(xhr.response.length);\n  for (let i = 0; i < xhr.response.length; ++i) {\n    ui8[i] = xhr.response.charCodeAt(i);\n  }\n  return ui8.toString();\n}\n\nexport function parse(data: any): any {\n  let ans = data;\n  if (typeof data === 'string') {\n    try {\n      ans = data = JSON.parse(data);\n    } catch (e) {\n      // do nothing\n    }\n  }\n\n  if (typeof data === 'string' && data.indexOf(uId) > 0) {\n    const [type, av, av2] = data.split(uId);\n\n    if (type === 'ArrayBuffer') ans = new Uint8Array(av.split(',').map(i => parseInt(i))).buffer;\n    else if (type === 'Blob') ans = decodeBlob(av2, av);\n    else ans = new window[type](av.split(','));\n  } else if (Array.isArray(data)) {\n    ans = [];\n    data.forEach((v, i) => {\n      ans[i] = parse(v);\n    });\n  } else if (typeof data === 'object') {\n    if (data === null) return null;\n    ans = {};\n    for (const k in data) {\n      ans[k] = parse(data[k]);\n    }\n  }\n  return ans;\n}\n\nexport function stringify(data: any): string {\n  if (typeof data !== 'object') return JSON.stringify(data);\n  if (data === null) return 'null';\n  if (Array.isArray(data)) return JSON.stringify(data.map(d => stringify(d)));\n  const type = toS.call(data).slice(8, -1);\n  if (type === 'Object') {\n    let ans = {};\n    for (let k in data) {\n      ans[k] = stringify(data[k]);\n    }\n    return JSON.stringify(ans);\n  } else if (type === 'ArrayBuffer') {\n    data = new Uint8Array(data);\n  } else if (type === 'Blob') {\n    data = data.type + uId + encodeBlob(data);\n  }\n  return type + uId + data.toString();\n}\n","import { SavedDataObject, SavedData } from '../storages/types';\n\n// always bind to storage\nexport const parseGetData = (\n  original: SavedDataObject,\n  onExpire: (k: string) => Promise<boolean> | undefined\n): object => {\n  const now = Date.now();\n  Object.keys(original).forEach(k => {\n    if (typeof original[k] === 'undefined') return;\n\n    const { createdAt, ttl } = original[k];\n    original[k] = original[k] && original[k].value;\n\n    if (ttl === 0) return;\n\n    if (now - createdAt > ttl) {\n      delete original[k];\n      onExpire && onExpire(k);\n    }\n  });\n  return original;\n};\n\nexport const parseSetValue = (value: any, defaultTtl: number): SavedData => {\n  if (value && value.value) {\n    value.ttl = value.ttl || defaultTtl;\n    value.createdAt = Date.now();\n    return value;\n  } else {\n    return {\n      value,\n      ttl: defaultTtl,\n      createdAt: Date.now()\n    };\n  }\n};\n\nexport const parseSetData = (\n  key: string | object,\n  value: any | undefined,\n  defaultTtl: number | undefined\n): SavedDataObject => {\n  if (typeof key === 'string') {\n    return { [key]: parseSetValue(value, defaultTtl) };\n  } else {\n    const data = {};\n    Object.keys(key).forEach(k => (data[k] = parseSetValue(key[k], defaultTtl)));\n    return data;\n  }\n};\n\nexport const parseKey = (key: string | string[]): string[] => {\n  if (Array.isArray(key)) {\n    return key;\n  } else {\n    return [key];\n  }\n};\n","import { stringify, parse } from '../utils/json';\nimport { parseGetData, parseKey, parseSetData } from '../utils/dataparser';\nimport { StorageOptions, SavedDataObject } from './types';\n\nconst defaultOptions: StorageOptions = {\n  name: 'SifrrStorage',\n  version: 1,\n  description: 'Sifrr Storage',\n  size: 5 * 1024 * 1024,\n  ttl: 0\n};\n\nabstract class Storage {\n  static type: string;\n\n  type: string = (<typeof Storage>this.constructor).type;\n\n  name: string;\n  version: string | number;\n  ttl: number;\n  description: string;\n  size: number;\n\n  tableName: string;\n  private table = {};\n\n  constructor(options: StorageOptions = defaultOptions) {\n    Object.assign(this, defaultOptions, options);\n    this.tableName = this.name + this.version;\n  }\n\n  // overwrited methods\n  protected select(keys: string[]): SavedDataObject | Promise<SavedDataObject> {\n    const table = this.getStore();\n    const ans = {};\n    keys.forEach(key => (ans[key] = table[key]));\n    return ans;\n  }\n\n  protected upsert(data: { [x: string]: any }): boolean | Promise<boolean> {\n    const table = this.getStore();\n    for (let key in data) {\n      table[key] = data[key];\n    }\n    this.setStore(table);\n    return true;\n  }\n\n  protected delete(keys: string[]): boolean | Promise<boolean> {\n    const table = this.getStore();\n    keys.forEach(key => delete table[key]);\n    this.setStore(table);\n    return true;\n  }\n\n  protected deleteAll(): boolean | Promise<boolean> {\n    this.setStore({});\n    return true;\n  }\n\n  protected getStore(): SavedDataObject | Promise<SavedDataObject> {\n    return this.table;\n  }\n\n  protected setStore(v: {}) {\n    this.table = v;\n  }\n\n  keys() {\n    return Promise.resolve(this.getStore()).then(d => Object.keys(d));\n  }\n\n  all() {\n    return Promise.resolve(this.getStore()).then(d => parseGetData(d, this.del.bind(this)));\n  }\n\n  get(key: string) {\n    return Promise.resolve(this.select(parseKey(key))).then(d =>\n      parseGetData(d, this.del.bind(this))\n    );\n  }\n\n  set(key: string | object, value: any) {\n    return Promise.resolve(this.upsert(parseSetData(key, value, this.ttl)));\n  }\n\n  del(key: string | string[]) {\n    return Promise.resolve(this.delete(parseKey(key)));\n  }\n\n  clear() {\n    return Promise.resolve(this.deleteAll());\n  }\n\n  memoize(\n    func: (...arg: any[]) => Promise<any>,\n    keyFunc = (...arg: any[]) => (typeof arg[0] === 'string' ? arg[0] : stringify(arg[0]))\n  ) {\n    return (...args: any) => {\n      const key = keyFunc(...args);\n      return this.get(key).then(data => {\n        if (data[key] === undefined || data[key] === null) {\n          const resultPromise = func(...args);\n          if (!(resultPromise instanceof Promise))\n            throw Error('Only promise returning functions can be memoized');\n          return resultPromise.then(v => {\n            return this.set(key, v).then(() => v);\n          });\n        } else {\n          return data[key];\n        }\n      });\n    };\n  }\n\n  isSupported(force = true) {\n    if (force && (typeof window === 'undefined' || typeof document === 'undefined')) {\n      return true;\n    } else if (window && this.hasStore()) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  protected hasStore() {\n    return true;\n  }\n\n  protected isEqual(other: { tableName: string; type: string }) {\n    if (this.tableName == other.tableName && this.type == other.type) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  // aliases\n  protected static stringify(data: any) {\n    return stringify(data);\n  }\n\n  protected static parse(data: string) {\n    return parse(data);\n  }\n\n  // one instance per store\n  protected static _all: Array<Storage>;\n  protected static _add(instance: Storage) {\n    this._all = this._all || [];\n    this._all.push(instance);\n  }\n\n  protected static _matchingInstance<T extends Storage>(otherInstance: Storage): T {\n    const all = this._all || [],\n      length = all.length;\n    for (let i = 0; i < length; i++) {\n      if (all[i].isEqual(otherInstance)) return <T>all[i];\n    }\n    this._add(otherInstance);\n    return <T>otherInstance;\n  }\n}\n\nexport default Storage;\n","import Storage from './storage';\nimport { StorageOptions } from './types';\n\nclass IndexedDB extends Storage {\n  private store: any;\n\n  constructor(options: StorageOptions) {\n    super(options);\n    return (<typeof IndexedDB>this.constructor)._matchingInstance<IndexedDB>(this);\n  }\n\n  protected select(keys: string[]) {\n    const ans = {};\n    const promises = [];\n    keys.forEach((key: string | number) =>\n      promises.push(this._tx('readonly', 'get', key, undefined).then((r: any) => (ans[key] = r)))\n    );\n    return Promise.all(promises).then(() => ans);\n  }\n\n  protected upsert(data: object) {\n    const promises = [];\n    for (let key in data) promises.push(this._tx('readwrite', 'put', data[key], key));\n    return Promise.all(promises).then(() => true);\n  }\n\n  protected delete(keys: string[]) {\n    const promises = [];\n    keys.forEach((key: any) => promises.push(this._tx('readwrite', 'delete', key, undefined)));\n    return Promise.all(promises).then(() => true);\n  }\n\n  protected deleteAll() {\n    return this._tx('readwrite', 'clear', undefined, undefined);\n  }\n\n  private _tx(scope: string, fn: string, param1: any, param2: string) {\n    const me = this;\n    this.store = this.store || this.createStore(me.tableName);\n    return this.store.then(\n      (db: {\n        transaction: (arg0: string, arg1: any) => { objectStore: (arg0: string) => void };\n      }) => {\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(me.tableName, scope).objectStore(me.tableName);\n          const request = tx[fn].call(tx, param1, param2);\n          request.onsuccess = (event: { target: { result: unknown } }) =>\n            resolve(event.target.result);\n          request.onerror = (event: { error: any }) => reject(event.error);\n        });\n      }\n    );\n  }\n\n  protected getStore() {\n    return this._tx('readonly', 'getAllKeys', undefined, undefined).then(this.select.bind(this));\n  }\n\n  private createStore(table: string) {\n    return new Promise((resolve, reject) => {\n      const request = window.indexedDB.open(table, 1);\n      request.onupgradeneeded = () => {\n        request.result.createObjectStore(table);\n      };\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  protected hasStore() {\n    return !!window.indexedDB;\n  }\n\n  static get type() {\n    return 'indexeddb';\n  }\n}\n\nexport default IndexedDB;\n","import Storage from './storage';\nimport { StorageOptions, SavedDataObject } from './types';\n\ntype websqlResult = {\n  rows: {\n    length: any;\n    item: { (arg0: number): { key: string; value: string } };\n  };\n};\n\ntype websqlStore = {\n  transaction(\n    a: (tx: {\n      executeSql: (arg0: any, arg1: any[], arg2: (tx: any, results: websqlResult) => void) => void;\n    }) => void\n  ): void;\n};\n\ndeclare global {\n  interface Window {\n    openDatabase: (name: string, version: number, z: any, a: any) => websqlStore;\n  }\n}\n\nclass WebSQL extends Storage {\n  private _store: websqlStore;\n\n  constructor(options: StorageOptions) {\n    super(options);\n    return (<typeof WebSQL>this.constructor)._matchingInstance(this);\n  }\n\n  protected parsedData() {}\n\n  protected select(keys: string[]) {\n    const q = keys.map(() => '?').join(', ');\n    // Need to give array for ? values in executeSql's 2nd argument\n    return this.execSql(`SELECT key, value FROM ${this.tableName} WHERE key in (${q})`, keys);\n  }\n\n  protected upsert(data: object) {\n    this.getWebsql().transaction((tx: { executeSql: (arg0: string, arg1: string[]) => void }) => {\n      for (let key in data) {\n        tx.executeSql(`INSERT OR REPLACE INTO ${this.tableName}(key, value) VALUES (?, ?)`, [\n          key,\n          (<typeof WebSQL>this.constructor).stringify(data[key])\n        ]);\n      }\n    });\n    return true;\n  }\n\n  protected delete(keys: string[]) {\n    const q = keys.map(() => '?').join(', ');\n    this.execSql(`DELETE FROM ${this.tableName} WHERE key in (${q})`, keys);\n    return true;\n  }\n\n  protected deleteAll() {\n    this.execSql(`DELETE FROM ${this.tableName}`);\n    return true;\n  }\n\n  protected getStore() {\n    return this.execSql(`SELECT key, value FROM ${this.tableName}`);\n  }\n\n  protected hasStore() {\n    return !!window.openDatabase;\n  }\n\n  private getWebsql() {\n    if (this._store) return this._store;\n    this._store = window.openDatabase('ss', 1, this.description, this.size);\n    this.execSql(`CREATE TABLE IF NOT EXISTS ${this.tableName} (key unique, value)`);\n    return this._store;\n  }\n\n  private execSql(query: string, args = []): Promise<SavedDataObject> {\n    const me = this;\n    return new Promise(resolve => {\n      me.getWebsql().transaction(function(tx) {\n        tx.executeSql(query, args, (tx, results) => {\n          resolve(me.parseResults(results));\n        });\n      });\n    });\n  }\n\n  private parseResults(results: websqlResult): SavedDataObject {\n    const ans = {};\n    const len = results.rows.length;\n    for (let i = 0; i < len; i++) {\n      ans[results.rows.item(i).key] = (<typeof WebSQL>this.constructor).parse(\n        results.rows.item(i).value\n      );\n    }\n    return ans;\n  }\n\n  static get type() {\n    return 'websql';\n  }\n}\n\nexport default WebSQL;\n","import Storage from './storage';\nimport { StorageOptions } from './types';\n\nclass LocalStorage extends Storage {\n  constructor(options: StorageOptions) {\n    super(options);\n    return (<typeof LocalStorage>this.constructor)._matchingInstance(this);\n  }\n\n  protected select(keys: string[]) {\n    const table = {};\n    keys.forEach((k: string) => {\n      const v = (<typeof LocalStorage>this.constructor).parse(\n        this.getLocalStorage().getItem(this.tableName + '/' + k)\n      );\n      if (v !== null) table[k] = v;\n    });\n    return table;\n  }\n\n  protected upsert(data: { [x: string]: any }) {\n    for (const key in data) {\n      this.getLocalStorage().setItem(\n        this.tableName + '/' + key,\n        (<typeof LocalStorage>this.constructor).stringify(data[key])\n      );\n    }\n    return true;\n  }\n\n  protected delete(keys: string[]) {\n    keys.map((k: string) => this.getLocalStorage().removeItem(this.tableName + '/' + k));\n    return true;\n  }\n\n  protected deleteAll() {\n    Object.keys(this.getLocalStorage()).forEach(k => {\n      if (k.indexOf(this.tableName) === 0) this.getLocalStorage().removeItem(k);\n    });\n    return true;\n  }\n\n  protected getStore() {\n    return this.select(\n      Object.keys(this.getLocalStorage())\n        .map(k => {\n          if (k.indexOf(this.tableName) === 0) return k.slice(this.tableName.length + 1);\n        })\n        .filter(k => typeof k !== 'undefined')\n    );\n  }\n\n  private getLocalStorage() {\n    return window.localStorage;\n  }\n\n  protected hasStore() {\n    return !!window.localStorage;\n  }\n\n  static get type() {\n    return 'localstorage';\n  }\n}\n\nexport default LocalStorage;\n","import Storage from './storage';\nimport { StorageOptions } from './types';\n\nconst date = new Date(0).toUTCString();\nconst equal = '%3D',\n  equalRegex = new RegExp(equal, 'g');\n\nclass Cookies extends Storage {\n  constructor(options: StorageOptions) {\n    super(options);\n    return (<typeof Cookies>this.constructor)._matchingInstance<Cookies>(this);\n  }\n\n  protected upsert(data: object) {\n    for (let key in data) {\n      this.setStore(\n        `${this.tableName}/${key}=${(<typeof Storage>this.constructor)\n          .stringify(data[key])\n          .replace(/=/g, equal)}; path=/`\n      );\n    }\n    return true;\n  }\n\n  protected delete(keys: string[]) {\n    keys.forEach((k: any) => this.setStore(`${this.tableName}/${k}=; expires=${date}; path=/`));\n    return true;\n  }\n\n  protected deleteAll() {\n    return this.keys().then(this.delete.bind(this));\n  }\n\n  protected getStore() {\n    let result = document.cookie,\n      ans = {};\n    result.split('; ').forEach(value => {\n      let [k, v] = value.split('=');\n      if (k.indexOf(this.tableName) === 0)\n        ans[k.slice(this.tableName.length + 1)] = (<typeof Storage>this.constructor).parse(\n          v.replace(equalRegex, '=')\n        );\n    });\n    return ans;\n  }\n\n  protected setStore(v: string) {\n    document.cookie = v;\n  }\n\n  protected hasStore() {\n    return typeof document.cookie !== 'undefined';\n  }\n\n  static get type() {\n    return 'cookies';\n  }\n}\n\nexport default Cookies;\n","import Storage from './storage';\nimport { StorageOptions } from './types';\n\nclass JsonStorage extends Storage {\n  constructor(options: StorageOptions) {\n    super(options);\n    return (<typeof JsonStorage>this.constructor)._matchingInstance(this);\n  }\n\n  protected hasStore() {\n    return true;\n  }\n\n  static get type() {\n    return 'jsonstorage';\n  }\n}\n\nexport default JsonStorage;\n","import IndexedDB from './storages/indexeddb';\nimport WebSQL from './storages/websql';\nimport LocalStorage from './storages/localstorage';\nimport Cookies from './storages/cookies';\nimport JsonStorage from './storages/jsonstorage';\nimport { StorageOptions } from './storages/types';\nimport Storage from './storages/storage';\n\ntype StorageConstructor = {\n  new (options: StorageOptions): Storage;\n};\n\nconst storages: { [x: string]: StorageConstructor } = {\n  [IndexedDB.type]: IndexedDB,\n  [WebSQL.type]: WebSQL,\n  [LocalStorage.type]: LocalStorage,\n  [Cookies.type]: Cookies,\n  [JsonStorage.type]: JsonStorage\n};\n\ntype MainOptions = StorageOptions & {\n  priority?: string[];\n};\n\nfunction getSupportedStoreFromPriority(\n  priority: string[] = [],\n  options: StorageOptions = {}\n): Storage {\n  priority = priority.concat([\n    IndexedDB.type,\n    WebSQL.type,\n    LocalStorage.type,\n    Cookies.type,\n    JsonStorage.type\n  ]);\n  for (let i = 0; i < priority.length; i++) {\n    let store = storages[priority[i]];\n    if (store) {\n      const storage = new store(options);\n      if (storage.isSupported()) return storage;\n    }\n  }\n  throw Error(\n    'No compatible storage found. Available types: ' + Object.keys(storages).join(', ') + '.'\n  );\n}\n\nfunction getStorage(options: string | MainOptions): Storage {\n  const priority = typeof options === 'string' ? [options] : (options || {}).priority;\n  const stOptions = typeof options === 'string' ? {} : options;\n\n  return getSupportedStoreFromPriority(priority, stOptions);\n}\n\nexport {\n  IndexedDB,\n  WebSQL,\n  LocalStorage,\n  Cookies,\n  JsonStorage,\n  getStorage,\n  storages as availableStores\n};\n"],"names":["toS","Object","prototype","toString","uId","decodeBlob","str","type","Blob","Uint8Array","split","buffer","encodeBlob","blob","uri","URL","createObjectURL","xhr","XMLHttpRequest","open","send","revokeObjectURL","ui8","response","length","i","charCodeAt","parse","data","ans","JSON","e","indexOf","av","av2","map","parseInt","window","Array","isArray","forEach","v","k","stringify","d","call","slice","parseGetData","original","onExpire","now","Date","keys","createdAt","ttl","value","parseSetValue","defaultTtl","parseSetData","key","parseKey","defaultOptions","name","version","description","size","Storage","constructor","options","assign","tableName","select","table","getStore","upsert","setStore","delete","deleteAll","Promise","resolve","then","all","del","bind","get","set","clear","memoize","func","keyFunc","arg","args","undefined","resultPromise","Error","isSupported","force","document","hasStore","isEqual","other","_add","instance","_all","push","_matchingInstance","otherInstance","IndexedDB","promises","_tx","r","scope","fn","param1","param2","me","store","createStore","db","reject","tx","transaction","objectStore","request","onsuccess","event","target","result","onerror","error","indexedDB","onupgradeneeded","createObjectStore","WebSQL","parsedData","q","join","execSql","getWebsql","executeSql","openDatabase","_store","query","results","parseResults","len","rows","item","LocalStorage","getLocalStorage","getItem","setItem","removeItem","filter","localStorage","date","toUTCString","equal","equalRegex","RegExp","Cookies","replace","cookie","JsonStorage","storages","getSupportedStoreFromPriority","priority","concat","storage","getStorage","stOptions"],"mappings":"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"}